# Failure Handling and Error Reporting
Mintee uses Crashlytics for error reporting.  
The following definitions are used as such throughout the document:  
* __Failure__: A code execution that has resulted in an error that cannot be corrected by user action.

# Table of Contents
1. [Guidelines](#guidelines)
1. [Crashlytics configurations](#crashlytics-configurations)
    1. [Build versioning](#build-versioning)

# Guidelines
- [Error reporting responsibilities](../../pull_request_template.md#error_reporting_responsibilities)
- [Failure handling by Views](../../pull_request_template.md#failure_handling_by_views)

# Crashlytics configurations
In order to separate testing and release data, Mintee uses the following build phases and configurations to capture data in 2 separate Firebase applications:  
1. The `Copy Bundle Resources` build phase copies both plists for the 2 Firebase applications to the built product bundle.
1. The `Update GoogleService-Info.plist` build phase copies and renames the appropriate Firebase plist to `GoogleService-Info.plist` in the built bundle. The resulting `.app` reports data to Firebase based on the following:  
    * Builds that use `GoogleService-Info-Debug.plist` report to Firebase application `Leko-Mintee (debug)`
    * Builds that use `GoogleService-Info-Release.plist` report to Firebase application `Leko-Mintee`

## Build versioning
To correlated reported errors with source code version, Mintee largely follows [Twitch's iOS versioning practices](https://blog.twitch.tv/en/2016/09/20/ios-versioning-89e02f0a5146/).
Mintee generates and updates the app's build version everytime the project is archived for distribution. This is achieved by the following build phases, targets, scripts, and configurations:  
1. Mintee preprocesses `Info.plist` by defining the following project-wide build settings:
    * `INFOPLIST_PREFIX_HEADER` = `${PROJECT_DIR}/Versions/versions.h`
    * `INFOPLIST_PREPROCESS` = `Yes`
1. Mintee's `Info.plist` sets the property `CFBundleVersion` to value `MinteeBuildNumber` (to be preprocessed).
1. Mintee's target dependency `Versions` is built before Mintee is. `Versions` contains the `Update build versions` run script phase, which generates a `versions.h` header file.
    * The `versions.h` contains a single preprocessor directive that defines the token `MinteeBuildNumber`, thus keeping up to date the `Info.plist` distributed with Mintee. `MinteeBuildNumber` is generated by concatenating the short commit version of the current branch's tip, `.`, and the current epoch in minutes.

__Notes__
* XCode actions using the `Debug` build configuration have, at times, not updated the Version number (unless a full clean and rebuild is executed). The exact issue and solution has not been found. The following (potential) workarounds are recommended to have the `Debug` build configuration generate a new version number for each build:  
    * In your machine's XCode developer dir, delete the `DerivedData` dir.
* For builds that use the `Release` configuration, the `Check Git changes` build phase of `Versions` is used to verify that the current branch is up-to-date with and tracking `origin/master`, with no merge conflicts or uncommitted changes.